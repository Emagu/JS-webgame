<!DOCTYPE html>
<html>
<head>
     <script src="lib/jquery.js"></script>
    <script src="src/Item/Item.js"></script>
    <script src="src/Option.js"></script>
    
</head>
<body></body>


<script>
/*
重寫物件，要設定開關
*/
        var GameArea,LeftControl,RightControl,TopControl;
        var LoginView,RegView,NewActorView,HallView,CreateRoomVieW;
        var Option;
        var player;
        var FocalVar=1;//焦距 最低1
        var MapCube=[];//存放所有地形資訊
        var Visualfield=[];//存放視野
        var MoveCube=[];//放移動方塊
        /*global UserData 實作於Data*/
        //var USER=new UserData();//用戶資料
        GameAreaInit();
        function GameAreaInit(){
            /*global OptionSet 實作於Option.js*/
            Option = new OptionSet();
            //document.body.style.width = Option.GameAreaWidth;
            //document.body.style.height = Option.GameAreaHeight;
            document.body.style.background="#000000";
            GameArea = document.createElement("div");
            //GameArea.style.width = "70%";
            //GameArea.style.height ="70%";
            GameArea.style.backgroundColor = "#000000";
            GameArea.style.margin = "0 auto";
            GameArea.style.position = 'absolute';
            
            GameArea.style.top = "0%";
            GameArea.style.left = "0%";
            //GameArea.style.overflow = "hidden";
           document.body.appendChild(GameArea);
           //document.body.style.overflow = 'hidden';
            /*global Item 實作於Item.js*/
            for(var i=0;i<Option.CubeX;i++){
                MapCube.push([]);
                for(var j=0;j<Option.CubeY;j++){
                    var item = new MapItem(i,j,'show',true,false);//x,y,type,Moveable,VisiAble
                    MapCube[i].push(item);
                }
            }
            var focalPos = new Object();
            focalPos.X = Option.CubeX / 2;
            focalPos.Y = Option.CubeY / 2;
            
            //以下測試插入玩家
            //player = new Item(18,10,1,"player","+",2);//x,y,ID,Type,MoveType,MoveRange
            
           
            player=parent.addPlayer();
            ViewItem();
            
            
            rendCube(focalPos);
            //直接把畫面到那邊
            window.scrollTo(player.Postion.X* (Option.CubeSize + Option.CubeLine * 2) * FocalVar, (player.Postion.Y-5)* (Option.CubeSize + Option.CubeLine * 2) * FocalVar);
            
        }//遊戲畫面初始化
        
        function rendCube(){// 聚焦中心位置
           
            for(var i=0;i<Option.CubeX;i++){
                for(var j=0;j<Option.CubeY;j++){
                    MapCube[i][j].Div.style.width = Option.CubeSize*FocalVar + "px";
                    MapCube[i][j].Div.style.height = Option.CubeSize*FocalVar + "px";
                    if(MapCube[i][j].VisiAble)
                    {
                    MapCube[i][j].Div.addEventListener('click',function(){
                       console.log(MapCube[i][j].Postion.X); 
                    });
                    switch (MapCube[i][j].Type) {
                        case 'player':
                            MapCube[i][j].Div.style.backgroundColor = "#FF0000";//for TEST
                            //console.log(i+","+j);
                            break;
                        case 'move':
                            MapCube[i][j].Div.style.backgroundColor = "#FFFF00";//for TEST
                            break;
                        case 'show':
                            MapCube[i][j].Div.style.backgroundColor = "#FFFFFF";//for TEST
                            break;
                        default:
                            MapCube[i][j].Div.style.backgroundColor = "#012345";//for TEST
                        }
                    }
                    else
                    {
                        MapCube[i][j].Div.style.backgroundColor = "#012345";//for TEST
                    }
                    MapCube[i][j].Div.style.left = (i * (Option.CubeSize + Option.CubeLine * 2) * FocalVar ) + "px";
                    MapCube[i][j].Div.style.top = (j * (Option.CubeSize + Option.CubeLine * 2) * FocalVar ) + "px";
                    GameArea.appendChild(MapCube[i][j].Div);
                   
                }
            
            }//畫面描繪
             for( i=0;i!=MoveCube.length;i++)
            {
                        GameArea.appendChild(MoveCube[i]);
            }
            GameArea.appendChild(player.Div);
             window.scrollTo((player.Postion.X-7)* (Option.CubeSize + Option.CubeLine * 2) * FocalVar, (player.Postion.Y-5)* (Option.CubeSize + Option.CubeLine * 2) * FocalVar);
                  
        }
        function ViewItem(){
            
            var CenterX = player.Postion.X;
            var CenterY = player.Postion.Y;
            var tmpPos = new Object();
            for(var i=0;i<Option.CubeX;i++){
                for(var j=0;j<Option.CubeY;j++){
                    MapCube[i][j].VisiAble=false;
                }
            }    
            var Horizons=player.ViewRange;
            for(var x=-Horizons;x<=Horizons;x++)
            {
                var tmp=Horizons-Math.abs(x);
                for(var y=-tmp;y<=tmp;y++)
                {
                    if(CenterX+x>=0 && CenterX+x<Option.CubeX && CenterY+y>=0 && CenterY+y<Option.CubeY)//邊界判定
                     MapCube[CenterX+x][CenterY+y].VisiAble=true;
                }
            }
            
        }
        function MoveItem(){
            function addEvent(x,y){//按下移動按鈕後
                    var MoveButton = document.createElement("div");
                    MoveButton.style.textAlig='center';
	                MoveButton.style.position = "absolute";
	                MoveButton.style.backgroundColor = "#FFFF00";
                	MoveButton.style.width = Option.CubeSize*FocalVar + "px";
                	MoveButton.style.height = Option.CubeSize*FocalVar + "px";
                	MoveButton.style.left = (x * (Option.CubeSize + Option.CubeLine * 2) * FocalVar ) + "px";
                    MoveButton.style.top = (y * (Option.CubeSize + Option.CubeLine * 2) * FocalVar ) + "px";
                    MoveButton.style.cursor = "pointer";
                    MoveButton.addEventListener("click",function(){
                    player.Move(x,y);
                    MoveCube.length=0;
                    ViewItem()
                    rendCube(player.Postion);
                    });
                 MoveCube.push(MoveButton);
                
            }
            var CenterX = player.Postion.X;
            var CenterY = player.Postion.Y;
            var Horizons=player.MoveRange;
            
            for(var x=-Horizons;x<=Horizons;x++)
            {
                var tmp=Horizons-Math.abs(x);
               
                for(var y=-tmp;y<=tmp;y++)
                {
                    //console.log(CenterX+x,CenterY+y,MapCube[CenterX+x][CenterY+y].MoveAble)
                    if(CenterX+x>=0 && CenterX+x<Option.CubeX && CenterY+y>=0 && CenterY+y<Option.CubeY)//邊界判定 
                    if(MapCube[CenterX+x][CenterY+y].MoveAble==true) //地形不允許
                    addEvent(CenterX+x,CenterY+y);
                    
                }
            }
    
            rendCube();
        }

</script>


</html>
